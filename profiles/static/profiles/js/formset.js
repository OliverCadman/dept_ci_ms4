/*
    Add extra text inputs dynamically in the 'Equipment List' fields, should the user need
    to add more items of equipment to be displayed.

    Referenced from YouTube tutorial:
    Title - Dynamic New Forms in a Django Formset Via JavaScript
    Uploader - CodingEntrepeneurs

    https://www.youtube.com/watch?v=s3T-w2jhDHE&list=PLEsfXFp6DpzRMby_cSoWTFw8zaMdTEXgL&index=64
*/

$(document).ready(function() {
    const addMoreBtn = document.getElementById("add_more_btn")

    addMoreBtn.addEventListener("click", addMoreForms)

    function addMoreForms(e) {
        e.preventDefault();

        // The div where the added input field will be appended 
        const formCopyTarget = document.getElementById("equipment_form_list");
        const formCopyEmptyEl = document
          .getElementById("empty_form")
          .cloneNode(true);

        formCopyEmptyEl.setAttribute("class", "equipment_form");
        
        // Hidden input field auto-generated by Django, to keep track of forms in model formset factory
        const totalForms = document.getElementById("id_form-TOTAL_FORMS")
        const currentEquipmentForms = document.getElementsByClassName("equipment_form")
        let currentFormCount = currentEquipmentForms.length
        formCopyEmptyEl.setAttribute("id", `form-${currentFormCount}`)

        totalForms.setAttribute("value", currentFormCount + 1)

        // Regex to update the new hidden input attributes when a new input field is added
        const regex = new RegExp("__prefix__", "g")
        formCopyEmptyEl.innerHTML = formCopyEmptyEl.innerHTML.replace(regex, currentFormCount)

        formCopyTarget.append(formCopyEmptyEl);
    }
})