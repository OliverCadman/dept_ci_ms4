{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% crispy invitation_form invitation_form.helper %}


{% block title %}DepT - Your Profile{% endblock %}
{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "css/profile_booking_includes.css" %}">
    <link rel="stylesheet" href="{% static "profiles/css/profile.css" %}">
    <link rel="stylesheet" href="{% static "profiles/css/bar-ui.css" %}">
{% endblock %}
{% block corejs %}
    {{ block.super }}
    <script src="{% static 'profiles/js/soundmanager2.js' %}"></script>
    <script src="{% static 'profiles/js/bar-ui.js' %}"></script>
{% endblock %}
{% block extra_head %}
    {{ form.media }}
{% endblock %}
{% block content %}
{% with page_name as p %}
    {% include "includes/profileheader_booking_success.html" %}
{% endwith %}

<div class="container-fluid bg-light">
    <div class="row">
        <!-- User Description and Reviews -->
        <div class="col-12 col-lg-8 description-review-container">
            <div class="user-desc-wrapper secondary_font">
                <p class="secondary_font">{{user.user_info|linebreaks}}</p>
            </div>
            <div id="review_wrapper">
                Review
            </div>
        </div>
        <div class="col-12 col-lg-4 music_player_container sidebar_lg p-0">
            <!-- Music Player -->
            {% if users_tracks|length > 0 %}
            <div id="music_player_wrapper" class="profile-card">
                <h3 class="sidebar_header">My Music {% if user.user.username == request.user.username %} <button type="button" class="btn edit_user_details_btn" data-bs-toggle="modal" data-bs-target="#edit_profile_modal"><span><i class="fas fa-edit edit_profile_icon"></i></span></button> {% endif %}</h3>
                <div id="music_player">
                    <div class="sm2-bar-ui playlist-open">
                        <div class="bd sm2-main-controls">
                            <div class="sm2-inline-texture"></div>
                            <div class="sm2-inline-gradient"></div>
                                <div class="sm2-inline-element sm2-button-element">
                                <div class="sm2-button-bd">
                                 <a href="#play" class="sm2-inline-button sm2-icon-play-pause">Play / pause</a>
                                </div>
                            </div>
                            <div class="sm2-inline-element sm2-inline-status">
                            <div class="sm2-playlist">
                                <div class="sm2-playlist-target"><ul class="sm2-playlist-bd"><li><b>SonReal</b> - LA<span class="label">Explicit</span></li></ul></div>
                            </div>
                            <div class="sm2-progress">
                                <div class="sm2-row">
                                    <div class="sm2-inline-time">0:00</div>
                                    <div class="sm2-progress-bd">
                                        <div class="sm2-progress-track">
                                            <div class="sm2-progress-bar"></div>
                                                <div class="sm2-progress-ball">
                                                    <div class="icon-overlay"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sm2-inline-duration">0:00</div>
                                    </div>
                                </div>
                            </div>
                            <div class="sm2-inline-element sm2-button-element sm2-volume">
                                <div class="sm2-button-bd">
                                    <span class="sm2-inline-button sm2-volume-control volume-shade"></span>
                                        <a href="#volume" class="sm2-inline-button sm2-volume-control">volume</a>
                                </div>
                            </div>
                            <div class="sm2-inline-element sm2-button-element">
                                <div class="sm2-button-bd">
                                    <a href="#prev" title="Previous" class="sm2-inline-button sm2-icon-previous">&lt; previous</a>
                                </div>
                            </div>
                            <div class="sm2-inline-element sm2-button-element">
                                <div class="sm2-button-bd">
                                    <a href="#next" title="Next" class="sm2-inline-button sm2-icon-next">&gt; next</a>
                                </div>
                            </div>
                            <div class="sm2-inline-element sm2-button-element sm2-menu">
                                <div class="sm2-button-bd">
                                    <a href="#menu" class="sm2-inline-button sm2-icon-menu">menu</a>
                                </div>
                            </div>
                        </div>
                        <div class="bd sm2-playlist-drawer sm2-element" style="height: 147px;">
                            <div class="sm2-inline-texture">
                                <div class="sm2-box-shadow"></div>
                            </div>
                            <div class="sm2-playlist-wrapper">
                                <ul class="sm2-playlist-bd">
                                    <!-- Track Name -->
                                    <li class="selected">
                                        <div class="sm2-row">
                                            <div class="sm2-col sm2-wide">
                                             <!-- Populated by JS with track name upon playback of each track -->
                                            </div>
                                        </div>
                                    </li>
                                    {% for track in users_tracks %}
                                        <li>
                                        <a href="{{track.file.url}}">{{track.file_name|capfirst}}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="sm2-extra-controls">
                                <div class="bd">
                                    <div class="sm2-inline-element sm2-button-element">
                                    <a href="#prev" title="Previous" class="sm2-inline-button sm2-icon-previous">&lt; previous</a>
                                    </div>
                                    <div class="sm2-inline-element sm2-button-element">
                                    <a href="#next" title="Next" class="sm2-inline-button sm2-icon-next">&gt; next</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            {% else %}
            <div id="no_tracks_container">
                <div id="no_tracks_wrapper">
                    <h6 class="text-center" id="no_tracks_header">No Tracks</h6>
                    <figure>
                        <img src="{{MEDIA_URL}}no-tracks-vector.png" alt="No Tracks" id="no_tracks_vector" width="200" height="200">
                    </figure>
                </div>
            </div>
            {% endif %}
            <div id="calendar_container" class="profile-card">
                <!-- Username to be used in AJAX call to get user's selected unavailable dates -->
                <input type="hidden" value="{{user_id}}" id="user_id">
                <h4 class="sidebar_header">My Availability {% if user.user.username == request.user.username %} <button type="button" class="btn edit_user_details_btn" data-bs-toggle="modal" data-bs-target="#edit_profile_modal"><span><i class="fas fa-edit edit_profile_icon"></i></span></button> {% endif %}</h4>
                <p class="text-center"><small>(Dates I am unavailable are marked in red)</small></p>
                <div id="calendar_wrapper"></div>
            </div>
            <div id="genre_list_container" class="float-md-end">
                <h5 class="sidebar_header">Genres {% if user.user.username == request.user.username %} <button type="button" class="btn edit_user_details_btn" data-bs-toggle="modal" data-bs-target="#edit_profile_modal"><span><i class="fas fa-edit edit_profile_icon"></i></span></button> {% endif %}</h5>
                {% if users_genres %}
                    <div id="genre_list_wrapper">
                        {% for genre in users_genres %}
                            {% if forloop.counter|divisibleby:"2" %}
                            <span class="badge genre_badge pushed">{{ genre }}</span>   
                            {% else %}
                            <span class="badge genre_badge">{{ genre }}</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<aside>
    <div class="modal fade" id="invitation_modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body invitation_form_container">
                    <div id="invitation_form_wrapper">
                        {% crispy invitation_form %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="review_modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body review_form_container">
                    <div id="review_form_wrapper">
                        <form action="{% url "profile" user.user.username %}" method="POST">
                            {% csrf_token %}
                             <h3 class='form-header'>Leave a review for {% if user.first_name %}{{user.first_name}}{% else %}{{ user.user.username }}{% endif %}</h3>
                            {% include "includes/star_icons.html" %}
                            {{ review_form|crispy }}
                            <button class="btn btn-primary" type="submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</aside>
{% endblock %}
{% block postload_js %}
    {{ block.super }}
    <script src="{% static "profiles/js/calendar_profile.js" %}"></script>
    <script src="{% static "bookings/js/rating.js" %}"></script>
    <script>
        $(function() {
            $("#date_time_picker").datetimepicker({
                format: "DD-MM-YY HH:mm:ss",
            })
        })
    </script>
{% endblock %}